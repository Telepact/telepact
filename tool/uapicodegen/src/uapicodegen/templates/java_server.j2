import org.uapi.Message;
import java.util.Map;

public abstract class ServerHandler {

    {%- for fn in functions %}
    {%- set function_name = fn | replace('fn.', '') %}
    public abstract {{ function_name }}.Output {{ function_name }}(Map<String, Object> headers, {{ function_name }}.Input input);
    {%- endfor %}

    public Message handler(Message message) {
        var functionName = message.body.keySet().stream().findAny().get();
        switch (functionName) {
            {%- for fn in functions %}
            {%- set function_name = fn | replace('fn.', '') %}
            case "{{ fn }}":
                return this.{{ function_name }}(message.header, {{ function_name }}.Input(message.body.values().findAny().get()));
            {%- endfor %}
            default:
                throw new IllegalArgumentException("Unknown function: " + functionName);
        }
    }

}