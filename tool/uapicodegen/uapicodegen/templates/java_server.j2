package {{ package }};

import uapi.Message;
import java.util.Map;

public abstract class ServerHandler_ {

    {%- for fn in functions %}
    {%- set function_name = fn | replace('fn.', '') %}
    public abstract {{ function_name }}.Output {{ function_name }}(Map<String, Object> headers, {{ function_name }}.Input input);
    {%- endfor %}

    public Message handler(Message message) {
        var entry = message.body.entrySet().stream().findAny().get();
        var functionName = entry.getKey();
        var input = (Map<String, Object>) entry.getValue();
        switch (functionName) {
            {%- for fn in functions %}
            {%- set function_name = fn | replace('fn.', '') %}
            case "{{ fn }}" -> {
                var output = this.{{ function_name }}(message.header, new {{ function_name }}.Input(input));
                return new Message(Map.of(), output.toUnionPseudoJson());
            }
            {%- endfor %}
            default -> throw new IllegalArgumentException("Unknown function: " + functionName);
        }
    }

}